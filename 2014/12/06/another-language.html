<!DOCTYPE html>
<html lang='ja'>
  <head>
    <title>Another language - プログラミング言語 Crystal</title>
    <meta charset='UTF-8'>
    <!-- Import Google Icon Font -->
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons|Roboto+Mono' rel='stylesheet'><link type="text/css" rel="stylesheet" href="/assets/stylesheet.css"><link href='/feed.xml' rel='alternate' title='Atom 1.0' type='application/atom+xml'>
    <link href='/favicon.png' rel='icon' type='image/png'>
    <link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Another language | プログラミング言語 Crystal</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Another language" />
<meta name="author" content="asterite" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Crystal has global type inference. You can program without type annotations except for a few cases where you are required to do so (generic type arguments)." />
<meta property="og:description" content="Crystal has global type inference. You can program without type annotations except for a few cases where you are required to do so (generic type arguments)." />
<link rel="canonical" href="https://ja.crystal-lang.org/2014/12/06/another-language.html" />
<meta property="og:url" content="https://ja.crystal-lang.org/2014/12/06/another-language.html" />
<meta property="og:site_name" content="プログラミング言語 Crystal" />
<meta property="og:image" content="https://ja.crystal-lang.org/images/icon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-12-06T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@CrystalLanguage" />
<meta name="twitter:creator" content="@asterite" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://ja.crystal-lang.org/2014/12/06/another-language.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ja.crystal-lang.org/images/crystal-h.png"},"name":"asterite"},"url":"https://ja.crystal-lang.org/2014/12/06/another-language.html","image":"https://ja.crystal-lang.org/images/icon.png","author":{"@type":"Person","name":"asterite"},"description":"Crystal has global type inference. You can program without type annotations except for a few cases where you are required to do so (generic type arguments).","headline":"Another language","dateModified":"2014-12-06T00:00:00+00:00","datePublished":"2014-12-06T00:00:00+00:00","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
 <!-- Let browser know website is optimized for mobile --><meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="wrapper "><nav role='navigation'>
  <div class='nav-wrapper no-select'>
    
      <a class='brand-logo' id='logo-container'>
        <canvas height='120' id='logo-canvas' style='cursor:move' width='120'></canvas>
      </a>
    
    <ul class='right hide-on-med-and-down' id='nav-desktop'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <ul class='side-nav' id='nav-mobile'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <a class='button-collapse' data-activates='nav-mobile' href='#'>
      <i class='material-icons'>menu</i>
    </a>
  </div>
</nav>
   <div class='post-header'>
  <div class="container">
    <div class='valign row'>
      <div class="col m2"></div>
      <div class="col s12 m9">
        <div class="author small">
          
          
            <img src="/assets/authors/asterite.jpg" width="360" height="360" alt="authors/asterite.jpg">
          
          
            <span class="author_name">Ary Borenzweig</span>
          
          
          
            <span class="date">06 Dec 2014</span>
          
        </div>

        <h1 class='title'>Another language</h1>
      </div>
      <div class="col m1"></div>
    </div>
  </div>
</div>
  <main><div class="container">
  <div class="row post-layout">
    <div class="col m2 share">
      <p class="title small share-title">Share</p>
      <div class="share-list">
        
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fja.crystal-lang.org%2F2014%2F12%2F06%2Fanother-language.html&text=Another+language&via=CrystalLanguage" target="_blank">
          <div class="share-item"><i class="extra-icons twitter gray"></i></div>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fja.crystal-lang.org%2F2014%2F12%2F06%2Fanother-language.html" target="_blank">
          <div class="share-item"><i class="extra-icons facebook gray"></i></div>
        </a>
        <a href="https://plus.google.com/share?url=https%3A%2F%2Fja.crystal-lang.org%2F2014%2F12%2F06%2Fanother-language.html" target="_blank">
          <div class="share-item"><i class="extra-icons google_plus gray"></i></div>
          </a>
      </div>
    </div>

    <div class="col s12 m9">
      <p>Crystal has global type inference. You can program without type annotations except
for a few cases where you are required to do so (generic type arguments).</p>

<p>This is a double-edged sword.</p>

<p>On one side, it’s really nice not to have to be explicit about types.
This allows for very quick prototyping, similar to dynamic languages.
You can quickly sketch an idea and evolve it without having to constantly
retype things. This is also very helpful when refactoring and reorganizing
code because the friction is very low. For example, when you extract
a method out of a piece of code you just specify the names of the arguments
and the compiler will take care of figuring out the arguments’ types and
the return type. Or you can start using an instance variable right away
by assigning some value to it, without having to declare it first with the
possible types it will hold.</p>

<p>But there are also some downsides to this approach. Let’s analyze each of them.</p>

<p><strong>Code becomes harder to understand and follow</strong></p>

<p>Some say that without type annotations a code becomes harder to follow. Let’s look
at an example.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
  <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">values</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="n">value</span>
  <span class="k">end</span>
  <span class="n">count</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>What is the type of <code class="highlighter-rouge">values</code>? How can one understand this piece of code
without knowing what type it operates on?</p>

<p>When you learned how to program we are sure that at one point you were introduced
to pseudocode. It looks similar to code you would find in real life, only it’s
simplified: you can rarely see type annotations there. Type is kind of obvious
in the context it is given. If you add type annotations and other information,
it would make it harder to see the code’s intention. Sounds familiar?</p>

<p>In our view, Ruby code is very close to pseudocode. In the above code there are
no type annotations. The algorithm is clear: iterate each of the items in <code class="highlighter-rouge">values</code>
and add them to a <code class="highlighter-rouge">count</code> variable. That’s it. What’s the type of <code class="highlighter-rouge">values</code>? It
doesn’t really matter. All we care about is that it can be iterated (with <code class="highlighter-rouge">each</code>) and
that it can be summed. Additionally, then name <code class="highlighter-rouge">sum</code>, <code class="highlighter-rouge">values</code> and <code class="highlighter-rouge">count</code> help
in understanding the method’s intention and the variables’ possible types.</p>

<p>Compare this to some other language where you would have to add some types:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">interface</span> <span class="no">Iterable</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span>
  <span class="k">def</span> <span class="nf">each</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span> <span class="p">:</span> <span class="no">T</span> <span class="o">-&gt;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">interface</span> <span class="no">Addable</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span>
  <span class="k">def</span> <span class="nf">+</span><span class="p">(</span><span class="n">other</span> <span class="p">:</span> <span class="no">T</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">values</span> <span class="p">:</span> <span class="no">Iterable</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">where</span> <span class="no">T</span> <span class="p">:</span> <span class="no">Addable</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span>
  <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">values</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="n">value</span>
  <span class="k">end</span>
  <span class="n">count</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Here we are telling the compiler that there is a type, <code class="highlighter-rouge">Iterable</code> that has an
<code class="highlighter-rouge">each</code> method that yields elements of a generic type <code class="highlighter-rouge">T</code>. Then we also tell the
compiler that there’s a type <code class="highlighter-rouge">Addable&lt;T&gt;</code> that has a method <code class="highlighter-rouge">+</code> that operates with
values of its same type. Finally, we define the <code class="highlighter-rouge">sum</code> method to operate on
values that belong to the <code class="highlighter-rouge">Iterable&lt;T&gt;</code> type, where each <code class="highlighter-rouge">T</code> implements
<code class="highlighter-rouge">Addable&lt;T&gt;</code>.</p>

<p>To us, this last code is farther from the pseudocode we had in mind. Also,
there’s more code to read and understand.</p>

<p>One possible counter-argument to this is that it now becomes easier to navigate
the code. I want to know how <code class="highlighter-rouge">each</code> is implemented, or what <code class="highlighter-rouge">Addable</code> is about, and
I know where to find that. We can’t do that with dynamic languages if we don’t
have type annotations.</p>

<p>But… wait! Crystal is not a dynamic language. When it finishes compiling it
assigns a type to every variable and method that were used. From that information we can recreate
the code and make it browsable. And, in fact, Crystal has a (very experimental)
tool for that, if you compile your code with <code class="highlighter-rouge">crystal browser file.cr</code>. This will
open a web browser where you can see the type of variables and navigate methods. So
in our opinion this is not a valid reason here.</p>

<p>This last thing also means that Crystal knows the type of a class’ instance variables.
In Ruby you might be looking at some class with a <code class="highlighter-rouge">@foo</code> instance variable and wonder
what its type is. Don’t worry, run <code class="highlighter-rouge">crystal hierarchy file.cr</code> and you will know the
exact type. This will be mostly useful if you run it in your spec files because these
show a class’ usage. And in the future it will be possible to view this
information in a documentation format like RDoc.</p>

<p><strong>Incremental compilation is not possible</strong></p>

<p>Because there are no type annotations, the compiler needs to figure out the type
of everything, each time, from scratch. There’s no way to compile a module to an
object file, or some other format, and later reuse that information, because there
isn’t any (type) information at first glance.</p>

<p>Luckily Crystal’s compiler is pretty fast: it takes between 5 and 10 seconds to
compile the whole compiler (just 2.3 seconds of that time is spent in the type
inference phase). For larger programs the time will become bigger, so
we will have to find a solution for this problem.</p>

<p>Another issue is that it is hard to do a <a href="http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a>.
If code always had type annotations we could generate machine code and not worry
about a variable’s type possibly changing, or even a type’s instance variables
being created or changed.</p>

<p>Many times we were tempted to give up. “If we require the programmer to add type
annotations in instance variables and methods, incremental compilation and a REPL
might become a reality”. “At least the syntax would be pleasant”.
Fourtunately, whenever one of us said that, another one replied with a big “NO”.</p>

<p>This “NO” has a very strong reason. If we change the language in that direction
we will end up with another language. Crystal is a language where you can leave out
type annotations (mind you: you can add type annotations if you really want to). But
if you are forced to add them, then it will not be Crystal anymore. It will probably
be very similar to one of the existing programming languages. And why would we want
to do that? What would be the benefit of inventing yet another language that is similar
to another language in existence (or maybe being developed)? None. It would be a waste
of time, a duplication of effort.</p>

<p>True, if we don’t give up we will face harder challenges. Is incremental compilation
really impossible? Couldn’t we think of a similar technique? Is a REPL doable somehow
in this language? Very interesting questions arise. Challenging problems appear. Fun
times come.</p>

<p>We believe a language where type annotations are not required from the compiler’s part,
but where types are still there, is possible. We want a smart compiler. We don’t want
to simplify the language to make our job, compiler writers, easier. We want to make
programmers work easier. And fun :-)</p>

    </div>
    <div class="col m1"></div>
  </div>
</div>
</main><footer>
  <div class="row">
    <div class="col s12 m12 l6 crystal">
      Crystal is licensed under the Apache License,
      <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>
        Version 2.0
      </a>
    </div>
    <div class="col s12 m12 l6 manas right-align black-text">
      Crystal language, born & raised at
      <a href="https://manas.tech" target="_blank" class="black-text">Manas</a>
      <a href="https://manas.tech" target="_blank" class="logo">
        <i class="manas"></i>
      </a>
    </div>
  </div>
</footer>
</div><script type="text/javascript" src="/assets/bundle.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42353458-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
