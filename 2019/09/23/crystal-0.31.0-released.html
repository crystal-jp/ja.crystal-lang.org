<!DOCTYPE html>
<html lang='ja'>
  <head>
    <title>Crystal 0.31.0 released! - プログラミング言語 Crystal</title>
    <meta charset='UTF-8'>
    <!-- Import Google Icon Font -->
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons|Roboto+Mono' rel='stylesheet'><link type="text/css" rel="stylesheet" href="/assets/stylesheet.css"><link href='/feed.xml' rel='alternate' title='Atom 1.0' type='application/atom+xml'>
    <link href='/favicon.png' rel='icon' type='image/png'>
    <link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Crystal 0.31.0 released! | プログラミング言語 Crystal</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Crystal 0.31.0 released!" />
<meta name="author" content="bcardiff" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Crystal 0.31.0 has been released!" />
<meta property="og:description" content="Crystal 0.31.0 has been released!" />
<link rel="canonical" href="https://ja.crystal-lang.org/2019/09/23/crystal-0.31.0-released.html" />
<meta property="og:url" content="https://ja.crystal-lang.org/2019/09/23/crystal-0.31.0-released.html" />
<meta property="og:site_name" content="プログラミング言語 Crystal" />
<meta property="og:image" content="https://ja.crystal-lang.org/images/icon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-09-23T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@CrystalLanguage" />
<meta name="twitter:creator" content="@bcardiff" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://ja.crystal-lang.org/2019/09/23/crystal-0.31.0-released.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ja.crystal-lang.org/images/crystal-h.png"},"name":"bcardiff"},"url":"https://ja.crystal-lang.org/2019/09/23/crystal-0.31.0-released.html","image":"https://ja.crystal-lang.org/images/icon.png","author":{"@type":"Person","name":"bcardiff"},"description":"Crystal 0.31.0 has been released!","headline":"Crystal 0.31.0 released!","dateModified":"2019-09-23T00:00:00+00:00","datePublished":"2019-09-23T00:00:00+00:00","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
 <!-- Let browser know website is optimized for mobile --><meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="wrapper "><nav role='navigation'>
  <div class='nav-wrapper no-select'>
    
      <a class='brand-logo' id='logo-container'>
        <canvas height='120' id='logo-canvas' style='cursor:move' width='120'></canvas>
      </a>
    
    <ul class='right hide-on-med-and-down' id='nav-desktop'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <ul class='side-nav' id='nav-mobile'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <a class='button-collapse' data-activates='nav-mobile' href='#'>
      <i class='material-icons'>menu</i>
    </a>
  </div>
</nav>
   <div class='post-header'>
  <div class="container">
    <div class='valign row'>
      <div class="col m2"></div>
      <div class="col s12 m9">
        <div class="author small">
          
          
            <img src="/assets/authors/bcardiff.jpg" width="360" height="360" alt="authors/bcardiff.jpg">
          
          
            <span class="author_name">Brian J. Cardiff</span>
          
          
          
            <span class="date">23 Sep 2019</span>
          
        </div>

        <h1 class='title'>Crystal 0.31.0 released!</h1>
      </div>
      <div class="col m1"></div>
    </div>
  </div>
</div>
  <main><div class="container">
  <div class="row post-layout">
    <div class="col m2 share">
      <p class="title small share-title">Share</p>
      <div class="share-list">
        
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fja.crystal-lang.org%2F2019%2F09%2F23%2Fcrystal-0.31.0-released.html&text=Crystal+0.31.0+released%21&via=CrystalLanguage" target="_blank">
          <div class="share-item"><i class="extra-icons twitter gray"></i></div>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fja.crystal-lang.org%2F2019%2F09%2F23%2Fcrystal-0.31.0-released.html" target="_blank">
          <div class="share-item"><i class="extra-icons facebook gray"></i></div>
        </a>
        <a href="https://plus.google.com/share?url=https%3A%2F%2Fja.crystal-lang.org%2F2019%2F09%2F23%2Fcrystal-0.31.0-released.html" target="_blank">
          <div class="share-item"><i class="extra-icons google_plus gray"></i></div>
          </a>
      </div>
    </div>

    <div class="col s12 m9">
      <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.31.0">Crystal 0.31.0</a> has been released!</p>

<p>This release comes with multi-threading preview, changes in numbers, performance improvements and as usual fixes and improvements in across the std-lib.</p>

<p>There are <a href="https://github.com/crystal-lang/crystal/compare/0.30.1...0.31.0">191 commits since 0.30.1</a> by 23 contributors.</p>

<p>Let’s review some highlights in this release. But don’t miss the rest of the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.31.0">release changelog</a> which has a lot of valuable information.</p>

<h2 id="language-changes">Language changes</h2>

<p>There is a new, and cleaner, way to declare type restrictions for non-captured blocks in a method.</p>

<p>A nameless parameter <code class="highlighter-rouge">&amp;</code> can now appear at the end of the list. It can optionally have type restrictions that will be used by the compiler and by the doc tool.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-crystal" data-lang="crystal"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span> <span class="p">:</span> <span class="no">Int32</span> <span class="o">-&gt;</span> <span class="no">Int32</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>There is no need to rewrite your current code base, but it’s a feature that will improve a bit the understanding to the reader. Especially if you used <code class="highlighter-rouge">&amp;block : T -&gt; S</code>, but didn’t mention <code class="highlighter-rouge">block</code> in the method body. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8117">#8117</a>.</p>

<h2 id="compiler">Compiler</h2>

<p>Since Crystal 0.29 the compiler is able to emit warnings. This feature is now opt-out, since the default is changed to <code class="highlighter-rouge">--warnings=all</code>. This will help you identify usages of deprecated methods and other language constructs as they appear. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8171">#8171</a>.</p>

<p>LLVM 8.0 is used in the Linux official packages. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8155">#8155</a>.</p>

<h2 id="standard-library">Standard library</h2>

<h3 id="multithreading">Multithreading</h3>

<p>One of the most awaited features landed between the previous release and this one, behind the <code class="highlighter-rouge">-Dpreview_mt</code> flag: Multithreading.
Even after merging <a href="https://github.com/crystal-lang/crystal/pull/8112">#8112</a> there were a couple of iterations to fix corner cases and stabilize the runtime.</p>

<p>Don’t miss <a href="https://crystal-lang.org/2019/09/06/parallelism-in-crystal.html">its dedicated blog post</a> where you can find out how to use it, the main API changes and its current limitations.</p>

<h3 id="numeric">Numeric</h3>

<p>There were a couple of changes in the numeric part of the std-lib announced a long time ago that finally made its way in this release.</p>

<p>Overflows are handled by default. <code class="highlighter-rouge">Int32::MAX + 1</code> will no longer wrap around. In case you need non-overflow operation you can use <code class="highlighter-rouge">Int32::MAX &amp;+ 1</code>. Same with <code class="highlighter-rouge">-</code> and <code class="highlighter-rouge">*</code>. In some architectures LLVM requires the compiler-rt library. We ported what was needed so there is no external dependency. If the new default behavior is blocking you, use <code class="highlighter-rouge">-Ddisable_overflow</code> to keep the same semantics as in 0.30 or <code class="highlighter-rouge">-Dskip_crystal_compiler_rt</code> to not include out compiler-rt port and link against another build of it. The <code class="highlighter-rouge">disable_overflow</code> flag is temporal and it will go away. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8170">#8170</a>.</p>

<p>The <code class="highlighter-rouge">/</code> will represent always the arithmetic division. This also means its result will be a float (of some kind). The expression <code class="highlighter-rouge">a.sum / a.size</code> will return the average, whatever numeric type is used in a. If you want the integer division that preserves the type of the left-hand side operarand use <code class="highlighter-rouge">//</code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8120">#8120</a>.</p>

<h3 id="collections">Collections</h3>

<p>The major changes in the collections are related to performance. <code class="highlighter-rouge">Array</code> and <code class="highlighter-rouge">Hash</code> were in the eye of these changes <a href="https://github.com/crystal-lang/crystal/pull/8017">#8017</a>, <a href="https://github.com/crystal-lang/crystal/pull/8042">#8042</a>, <a href="https://github.com/crystal-lang/crystal/pull/8048">#8048</a>, <a href="https://github.com/crystal-lang/crystal/pull/8087">#8087</a>, <a href="https://github.com/crystal-lang/crystal/pull/8116">#8116</a>. There seems to always be room for improvement (take 1).</p>

<h3 id="serialization">Serialization</h3>

<p>There is a breaking-change regarding XML, yet the main API has not changed. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8134">#8134</a></p>

<p>A probably more impactful change is that JSON and YAML deserialization can now handle <code class="highlighter-rouge">NamedTuple</code> with nilable fields. Read more at  <a href="https://github.com/crystal-lang/crystal/pull/8109">#8109</a>.</p>

<p>And there was some missing setting in YAML to emit unicode. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8132">#8132</a>.</p>

<h3 id="files">Files</h3>

<p>Optimizations were not only present in collections. Follow the path and you will find improvements in <code class="highlighter-rouge">Path#join</code> and <code class="highlighter-rouge">Dir.glob</code>.  <a href="https://github.com/crystal-lang/crystal/pull/8078">#8078</a>, <a href="https://github.com/crystal-lang/crystal/pull/8082">#8082</a>, <a href="https://github.com/crystal-lang/crystal/pull/8081">#8081</a>. There seems to always be room for improvement (take 2).</p>

<h3 id="networking">Networking</h3>

<p>The <code class="highlighter-rouge">HTTP::Server::Response#respond_with_error</code> is deprecated in favor of <code class="highlighter-rouge">#respond_with_status</code> that will also handle the final state of the connection and default status description. Read more at <a href="https://github.com/crystal-lang/crystal/pull/6988">#6988</a>.</p>

<p>The built-in HTTP server will respond in a more controlled way to requests with long URIs or large header fields. The default limit of 1MB can be configured. The response will be <code class="highlighter-rouge">414 Request-URI too long</code> and <code class="highlighter-rouge">431 Request Header Fields Too Large</code> respectively. This logic is implemented in <code class="highlighter-rouge">HTTP::Request.from_io</code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8013">#8013</a>.</p>

<h3 id="other-deprecations">Other deprecations</h3>

<p>The <code class="highlighter-rouge">Markdown</code> module is no longer exposed in the std-lib. It’s still used internally and there is an ongoing discussion regarding a future official markdown package. For now, the best replacement is <a href="https://github.com/icyleaf/markd">icyleaf/markd</a>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8115">#8115</a> and <a href="https://github.com/crystal-lang/crystal/issues/4613">#4613</a>.</p>

<p>You should drop the <code class="highlighter-rouge">!</code> from <code class="highlighter-rouge">OptionParser#parse!</code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8041">#8041</a>.</p>

<h3 id="crystal-db-070">Crystal-db 0.7.0</h3>

<p>A new release of <a href="https://github.com/crystal-lang/crystal-db">crystal-lang/crystal-db</a> is also available. Updates to drivers and frameworks were sent to use the new release.</p>

<p>Some concurrency issues that might cause a peak in the number of connections created were fixed. This is also an important update for multi-threading contexts. Read more at <a href="https://github.com/crystal-lang/crystal-db/pull/109">crystal-db#109</a>.</p>

<p>There is also a breaking-change required to avoid an ambiguity for drivers that support columns with Array values. <code class="highlighter-rouge">db.query("SELECT ...", [1,2])</code> now means a single argument: <code class="highlighter-rouge">[1, 2]</code>, and <code class="highlighter-rouge">db.query("SELECT ...", args: [1, 2])</code> means that two arguments are passed to the query.</p>

<h2 id="spec">Spec</h2>

<p>Given a <code class="highlighter-rouge">describe</code>, <code class="highlighter-rouge">context</code> or <code class="highlighter-rouge">it</code> in a spec, you can now add a <code class="highlighter-rouge">focus: true</code>. When you do that, only the things that are marked with <code class="highlighter-rouge">focus: true</code> will run.</p>

<p>Also, if a line that ended someplace outside the <code class="highlighter-rouge">it</code> but inside a <code class="highlighter-rouge">describe</code> is specified, the whole <code class="highlighter-rouge">describe</code> will run.</p>

<p>This new behavior leads to a breaking change in case you shared local variables within <code class="highlighter-rouge">it</code> blocks. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8125">#8125</a>.</p>

<h2 id="doc-generator">Doc generator</h2>

<p>Writing documentation for a type hierarchy got a bit better. The content of a previous <code class="highlighter-rouge">def</code> or ancestor is automatically inherited (with a nice note stating so) or it can be explicitly placed within new docs using an <code class="highlighter-rouge">:inherit:</code> placeholder. Read more at <a href="https://github.com/crystal-lang/crystal/pull/6989">#6989</a>.</p>

<h2 id="next-steps">Next steps</h2>

<p>Please update your Crystal and report any issues. We will keep moving forward and start the development focusing on 0.32.</p>

<p>It will also be helpful if your shards are run against Crystal nightly releases. Either Docker or Snap are the current channels to get them easily. This will help reduce the friction of a release while checking if the ecosystem is in good shape.</p>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a>, and every other <a href="/sponsors">sponsor</a>. It is extremely important for us to sustain the support through donations, so that we can maintain this development pace. <a href="https://opencollective.com/crystal-lang">OpenCollective</a> and <a href="https://salt.bountysource.com/teams/crystal-lang">Bountysource</a> are two available channels for that. Reach out to <a href="mailto:crystal@manas.tech">crystal@manas.tech</a> if you’d like to become a direct sponsor or find other ways to support Crystal. We thank you in advance!</p>

    </div>
    <div class="col m1"></div>
  </div>
</div>
</main><footer>
  <div class="row">
    <div class="col s12 m12 l6 crystal">
      Crystal is licensed under the Apache License,
      <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>
        Version 2.0
      </a>
    </div>
    <div class="col s12 m12 l6 manas right-align black-text">
      Crystal language, born & raised at
      <a href="https://manas.tech" target="_blank" class="black-text">Manas</a>
      <a href="https://manas.tech" target="_blank" class="logo">
        <i class="manas"></i>
      </a>
    </div>
  </div>
</footer>
</div><script type="text/javascript" src="/assets/bundle.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42353458-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
